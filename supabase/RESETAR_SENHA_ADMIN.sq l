-- ========================================
-- RESETAR SENHA DO SUPER ADMIN
-- ========================================

-- IMPORTANTE: Este script redefine a senha para: Admin123!

-- Atualizar senha do usuário faiteloficial@gmail.com
UPDATE auth.users
SET 
  encrypted_password = crypt('Admin123!', gen_salt('bf')),
  email_confirmed_at = NOW(),
  confirmed_at = NOW()
WHERE email = 'faiteloficial@gmail.com';

-- Verificar usuário
SELECT 
  id,
  email,
  email_confirmed_at,
  created_at
FROM auth.users
WHERE email = 'faiteloficial@gmail.com';

-- Garantir roles de super_admin
INSERT INTO public.user_roles (user_id, role)
SELECT id, 'super_admin'
FROM auth.users
WHERE email = 'faiteloficial@gmail.com'
ON CONFLICT (user_id, role) DO NOTHING;

INSERT INTO public.user_roles (user_id, role)
SELECT id, 'admin'
FROM auth.users
WHERE email = 'faiteloficial@gmail.com'
ON CONFLICT (user_id, role) DO NOTHING;

-- Verificar roles
SELECT 
  ur.role,
  au.email
FROM public.user_roles ur
JOIN auth.users au ON au.id = ur.user_id
WHERE au.email = 'faiteloficial@gmail.com'
ORDER BY ur.role;
